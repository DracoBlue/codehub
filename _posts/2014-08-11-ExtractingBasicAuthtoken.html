---
layout: default
title: Basic HTTP Auth with user_key
categories: Nginx Lua Authentication
comments: true
---

<h1>{{ page.title }}</h1>
<dl>
	<dt>Author:</dt>
		<dd>Victor Delgado</dd>
	<dt>Version:</dt>
		<dd>1.0</dd>
	<dt>Language:</dt>
		<dd>Lua</dd>
</dl>
<p><strong>Description:</strong> First of all, some of the money will go directly to the speakers to compensate their costs to come to Barcelona and give some great talks. If that's not convincing enough, we'll serve you refreshments, have two coffee breaks and a lunch break. And we're not talking conference food, but a Mediterranean-style menu, tapas, sandwiches and other snacks prepared by awesome local chefs.</p>

{% highlight lua linenos=table %}
--[[
Authorization logic
]]--
 
function get_auth_params(where, method)
	local params = {}
	if where == "headers" then
		params = ngx.req.get_headers()
	elseif where == "basicauth" then
		params = ngx.req.get_headers()
		if params["Authorization"] then
			local m = ngx.re.match(params["Authorization"], "Basic\\s(.+)")
			if m params
				then.user_key = m[1]
			end
		end	 
		elseif method == "GET" then
			params = ngx.req.get_uri_args()
		else
			ngx.req.read_body()
			params = ngx.req.get_post_args()
		end
	return first_values(params)
end
{% endhighlight %}

<!-- DISQUS -->
{% if page.comments %}
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
	    var disqus_shortname = 'testandrzej'; // required: replace example with your forum shortname

	    /* * * DON'T EDIT BELOW THIS LINE * * */
	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
	<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
{% endif %}
