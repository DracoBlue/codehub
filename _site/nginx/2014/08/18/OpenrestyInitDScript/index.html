<!DOCTYPE html>
<!--[if IE 9]><html class="lt-ie10" lang="en" > <![endif]--> 
<html class="no-js" lang="en"> 
  <head>
    <title>Openresty init.d script | 3scale Documentation</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" type="text/css" href='//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css'>
    <link rel="stylesheet" type="text/css" href='//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css'>
    <link rel="stylesheet" type="text/css" href='/css/jquery.tocify.css'>
    <link rel="stylesheet" type="text/css" href='/css/jquery.ui.all.css'>
    <link rel="stylesheet" type="text/css" href='/css/prototype.css'>
    <link rel="stylesheet" type="text/css" href='/css/syntax.css'>
  

    <script type="text/javascript" src="/javascript/modernizr.js"></script>
    <!--<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>-->
    
  </head>

<body>
  <!-- body content here -->
  <div class="container-fluid">
    <section class="row">
      <header class="fixed-header col-md-12">
        <div class="row">
          <div class="col-md-2 col-xs-4 logo">
            <a href="http://support.3scale.net" style="width: 155px; position: relative;"><img style="
    margin-top: 1px;
" src="https://support.3scale.net/images/3scale-logo-transparent.png"><span style="color: white; position: absolute; font-variant: small-caps; font-family: Verdana; right: 0px; bottom: -24px;">Docs</span></a>
          </div>
          <div class="col-md-6">
            <div class="row" id="search">
              <form action="/search" method="get" class="col-md-10">
                <input class="text" name="q" type="text" id="search-query" title="Search the site" placeholder="Search" autocomplete="off" >
              </form>
              <div class="col-md-2 head-butt"><a class="btn btn-default" href="/"><i class="fa fa-code"></i>CodeHub</a></div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="row">               
              <div class="col-md-3 head-butt"><a href="/" class="btn btn-default"><i class="fa fa-book"></i>Docs</a></div>
              <div class="col-md-3 head-butt"><a href="/help" class="btn btn-default"><i class="fa fa-question-circle"></i>Help</a></div>
              <div class="col-md-3 head-butt"><a href="/forum" class="btn btn-default"><i class="fa fa-comments"></i>Forum</a></div>
              <div class="col-md-3 head-butt"><a href="http://www.3scale.net/blog" class="btn btn-default"><i class="fa fa-rss"></i>Blog</a></div>
            </div>
          </div>
        </div>
      </header>
    </section>
    <div class="row document-content">
      <div class="fill col-md-2 col-sm-3 col-xs-4">
          <div class="tocify1">
  <!-- OVERVIEW -->
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/nginx/">nginx</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/lua/">lua</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/authentication/">authentication</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/reporting/">reporting</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/varnish/">varnish</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/html/">html</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/liquid/">liquid</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/js/">js</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/developerportal/">developerportal</a></li>
        
      </ul>
    
      <ul class="tocheader nav nav-list">
        
          <li class="multi"><a href="/caching/">caching</a></li>
        
      </ul>
    
  <!-- CASE STUDIES -->
  <!--<ul class="tocheader nav nav-list">
    <li class=""><a>Case Studies</a></li>
  </ul>-->

  <!-- CODEHUB -->
  <!--<ul class="tocheader nav nav-list">
    <li class=""><a>Code Hub</a></li>
  </ul>-->
</div>
      </div>
      <div class="col-md-10 col-sm-9 col-xs-8">
        <div class="row">
          <div class="col-lg-10 col-md-11 col-sm-12">
            
            <section id="search-results" style="display: none;">
              <h2>Search results</h2>
              <div class="entries">
                
                <script id="search-results-template" type="text/mustache">
                  {{#entries}}
                    <article>
                      <p>
                        {{#date}}<small><time datetime="{{pubdate}}" pubdate>{{displaydate}}</time></small>{{/date}}
                        <a href="{{url}}">{{title}}</a>
                      </p>
                    </article>
                  {{/entries}}
                </script>
                
              </div>
            </section>
            <section id="page-content">        
              <h1>Openresty init.d script</h1>
<dl>
	<dt>Author:</dt>
		<dd>Victor Delgado</dd>
	<dt>Version:</dt>
		<dd>1.0</dd>
	<dt>Language:</dt>
		<dd>init.d</dd>
</dl>
<p><strong>Description:</strong> First of all, some of the money will go directly to the speakers to compensate their costs to come to Barcelona and give some great talks. If that's not convincing enough, we'll serve you refreshments, have two coffee breaks and a lunch break. And we're not talking conference food, but a Mediterranean-style menu, tapas, sandwiches and other snacks prepared by awesome local chefs.</p>

<div class="highlight"><pre><code class="language-sh" data-lang="sh"><span class="lineno">  1</span> <span class="c">#!/bin/sh</span>
<span class="lineno">  2</span> <span class="c">#</span>
<span class="lineno">  3</span> <span class="c"># chkconfig: 2345 55 25</span>
<span class="lineno">  4</span> <span class="c"># Description: Nginx init.d script, put in /etc/init.d, chmod +x /etc/init.d/nginx</span>
<span class="lineno">  5</span> <span class="c"># For Debian, run: update-rc.d -f nginx defaults</span>
<span class="lineno">  6</span> <span class="c"># For CentOS, run: chkconfig --add nginx</span>
<span class="lineno">  7</span> <span class="c">#</span>
<span class="lineno">  8</span> <span class="c">### BEGIN INIT INFO</span>
<span class="lineno">  9</span> <span class="c"># Provides: nginx</span>
<span class="lineno"> 10</span> <span class="c"># Required-Start: $all</span>
<span class="lineno"> 11</span> <span class="c"># Required-Stop: $all</span>
<span class="lineno"> 12</span> <span class="c"># Default-Start: 2 3 4 5</span>
<span class="lineno"> 13</span> <span class="c"># Default-Stop: 0 1 6</span>
<span class="lineno"> 14</span> <span class="c"># Short-Description: nginx init.d script</span>
<span class="lineno"> 15</span> <span class="c"># Description: OpenResty (aka. ngx_openresty) is a full-fledged web application server by bundling the standard Nginx core, lots of 3rd-party Nginx modules, as well as most of their external dependencies.</span>
<span class="lineno"> 16</span> <span class="c">### END INIT INFO</span>
<span class="lineno"> 17</span> <span class="c">#</span>
<span class="lineno"> 18</span>  
<span class="lineno"> 19</span> <span class="nv">PATH</span><span class="o">=</span>/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
<span class="lineno"> 20</span> <span class="nv">DESC</span><span class="o">=</span><span class="s2">&quot;Nginx Daemon&quot;</span>
<span class="lineno"> 21</span> <span class="nv">NAME</span><span class="o">=</span>nginx
<span class="lineno"> 22</span> <span class="nv">PREFIX</span><span class="o">=</span>/usr/local/openresty/nginx
<span class="lineno"> 23</span> <span class="nv">DAEMON</span><span class="o">=</span><span class="nv">$PREFIX</span>/sbin/<span class="nv">$NAME</span>
<span class="lineno"> 24</span> <span class="nv">CONF</span><span class="o">=</span><span class="nv">$PREFIX</span>/conf/<span class="nv">$NAME</span>.conf
<span class="lineno"> 25</span> <span class="nv">PID</span><span class="o">=</span><span class="nv">$PREFIX</span>/logs/<span class="nv">$NAME</span>.pid
<span class="lineno"> 26</span> <span class="nv">SCRIPT</span><span class="o">=</span>/etc/init.d/<span class="nv">$NAME</span>
<span class="lineno"> 27</span>  
<span class="lineno"> 28</span> <span class="k">if</span> <span class="o">[</span> ! -x <span class="s2">&quot;$DAEMON&quot;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> ! -f <span class="s2">&quot;$CONF&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="lineno"> 29</span> 	<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $DAEMON has no permission to run. \033[0m&quot;</span>
<span class="lineno"> 30</span> 	<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m Or $CONF doesn&#39;t exist. \033[0m&quot;</span>
<span class="lineno"> 31</span> 	sleep 1
<span class="lineno"> 32</span> 	<span class="nb">exit </span>1
<span class="lineno"> 33</span> <span class="k">fi</span>
<span class="lineno"> 34</span>  
<span class="lineno"> 35</span> do_start<span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 36</span> 	<span class="k">if</span> <span class="o">[</span> -f <span class="nv">$PID</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="lineno"> 37</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $PID already exists. \033[0m&quot;</span>
<span class="lineno"> 38</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $DESC is already running or crashed. \033[0m&quot;</span>
<span class="lineno"> 39</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[32m $DESC Reopening $CONF ... \033[0m&quot;</span>
<span class="lineno"> 40</span> 		<span class="nv">$DAEMON</span> -s reopen -c <span class="nv">$CONF</span>
<span class="lineno"> 41</span> 		sleep 1
<span class="lineno"> 42</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[36m $DESC reopened. \033[0m&quot;</span>
<span class="lineno"> 43</span> 	<span class="k">else</span>
<span class="lineno"> 44</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[32m $DESC Starting $CONF ... \033[0m&quot;</span>
<span class="lineno"> 45</span> 		<span class="nv">$DAEMON</span> -c <span class="nv">$CONF</span>
<span class="lineno"> 46</span> 		sleep 1
<span class="lineno"> 47</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[36m $DESC started. \033[0m&quot;</span>
<span class="lineno"> 48</span> 	<span class="k">fi</span>
<span class="lineno"> 49</span> <span class="o">}</span>
<span class="lineno"> 50</span>  
<span class="lineno"> 51</span> do_stop<span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 52</span> 	<span class="k">if</span> <span class="o">[</span> ! -f <span class="nv">$PID</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="lineno"> 53</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $PID doesn&#39;t exist. \033[0m&quot;</span>
<span class="lineno"> 54</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $DESC isn&#39;t running. \033[0m&quot;</span>
<span class="lineno"> 55</span> 	<span class="k">else</span>
<span class="lineno"> 56</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[32m $DESC Stopping $CONF ... \033[0m&quot;</span>
<span class="lineno"> 57</span> 		<span class="nv">$DAEMON</span> -s stop -c <span class="nv">$CONF</span>
<span class="lineno"> 58</span> 		sleep 1
<span class="lineno"> 59</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[36m $DESC stopped. \033[0m&quot;</span>
<span class="lineno"> 60</span> 	<span class="k">fi</span>
<span class="lineno"> 61</span> <span class="o">}</span>
<span class="lineno"> 62</span>  
<span class="lineno"> 63</span> do_reload<span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 64</span> 	<span class="k">if</span> <span class="o">[</span> ! -f <span class="nv">$PID</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="lineno"> 65</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $PID doesn&#39;t exist. \033[0m&quot;</span>
<span class="lineno"> 66</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $DESC isn&#39;t running. \033[0m&quot;</span>
<span class="lineno"> 67</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[32m $DESC Starting $CONF ... \033[0m&quot;</span>
<span class="lineno"> 68</span> 		<span class="nv">$DAEMON</span> -c <span class="nv">$CONF</span>
<span class="lineno"> 69</span> 		sleep 1
<span class="lineno"> 70</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[36m $DESC started. \033[0m&quot;</span>
<span class="lineno"> 71</span> 	<span class="k">else</span>
<span class="lineno"> 72</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[32m $DESC Reloading $CONF ... \033[0m&quot;</span>
<span class="lineno"> 73</span> 		<span class="nv">$DAEMON</span> -s reload -c <span class="nv">$CONF</span>
<span class="lineno"> 74</span> 		sleep 1
<span class="lineno"> 75</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[36m $DESC reloaded. \033[0m&quot;</span>
<span class="lineno"> 76</span> 	<span class="k">fi</span>
<span class="lineno"> 77</span> <span class="o">}</span>
<span class="lineno"> 78</span>  
<span class="lineno"> 79</span> do_quit<span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 80</span> 	<span class="k">if</span> <span class="o">[</span> ! -f <span class="nv">$PID</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
<span class="lineno"> 81</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $PID doesn&#39;t exist. \033[0m&quot;</span>
<span class="lineno"> 82</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[33m $DESC isn&#39;t running. \033[0m&quot;</span>
<span class="lineno"> 83</span> 	<span class="k">else</span>
<span class="lineno"> 84</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[32m $DESC Quitting $CONF ... \033[0m&quot;</span>
<span class="lineno"> 85</span> 		<span class="nv">$DAEMON</span> -s quit -c <span class="nv">$CONF</span>
<span class="lineno"> 86</span> 		sleep 1
<span class="lineno"> 87</span> 		<span class="nb">echo</span> -e <span class="s2">&quot;\033[36m $DESC quitted. \033[0m&quot;</span>
<span class="lineno"> 88</span> 	<span class="k">fi</span>
<span class="lineno"> 89</span> <span class="o">}</span>
<span class="lineno"> 90</span>  
<span class="lineno"> 91</span> do_test<span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 92</span> 	<span class="nb">echo</span> -e <span class="s2">&quot;\033[32m $DESC Testing $CONF ... \033[0m&quot;</span>
<span class="lineno"> 93</span> 	<span class="nv">$DAEMON</span> -t -c <span class="nv">$CONF</span>
<span class="lineno"> 94</span> <span class="o">}</span>
<span class="lineno"> 95</span>  
<span class="lineno"> 96</span> do_info<span class="o">()</span> <span class="o">{</span>
<span class="lineno"> 97</span> 	<span class="nv">$DAEMON</span> -V
<span class="lineno"> 98</span> <span class="o">}</span>
<span class="lineno"> 99</span>  
<span class="lineno">100</span> <span class="k">case</span> <span class="s2">&quot;$1&quot;</span> in
<span class="lineno">101</span> 	start<span class="o">)</span>
<span class="lineno">102</span> 	do_start
<span class="lineno">103</span> 	<span class="p">;;</span>
<span class="lineno">104</span> 	stop<span class="o">)</span>
<span class="lineno">105</span> 	do_stop
<span class="lineno">106</span> 	<span class="p">;;</span>
<span class="lineno">107</span> 	reload<span class="o">)</span>
<span class="lineno">108</span> 	do_reload
<span class="lineno">109</span> 	<span class="p">;;</span>
<span class="lineno">110</span> 	restart<span class="o">)</span>
<span class="lineno">111</span> 	do_stop
<span class="lineno">112</span> 	do_start
<span class="lineno">113</span> 	<span class="p">;;</span>
<span class="lineno">114</span> 	quit<span class="o">)</span>
<span class="lineno">115</span> 	do_quit
<span class="lineno">116</span> 	<span class="p">;;</span>
<span class="lineno">117</span> 	<span class="nb">test</span><span class="o">)</span>
<span class="lineno">118</span> 	do_test
<span class="lineno">119</span> 	<span class="p">;;</span>
<span class="lineno">120</span> 	info<span class="o">)</span>
<span class="lineno">121</span> 	do_info
<span class="lineno">122</span> 	<span class="p">;;</span>
<span class="lineno">123</span> 	*<span class="o">)</span>
<span class="lineno">124</span> 	<span class="nb">echo</span> <span class="s2">&quot;Usage: $SCRIPT {start|stop|reload|restart|quit|test|info}&quot;</span>
<span class="lineno">125</span> 	<span class="nb">exit </span>2
<span class="lineno">126</span> 	<span class="p">;;</span>
<span class="lineno">127</span> <span class="k">esac</span>
<span class="lineno">128</span>  
<span class="lineno">129</span> <span class="nb">exit </span>0</code></pre></div>       
            </section> 
            <!-- DISQUS -->
            
              <div id="disqus_thread"></div>
              <script type="text/javascript">
                  /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
                  var disqus_shortname = 'testandrzej'; // required: replace example with your forum shortname

                  /* * * DON'T EDIT BELOW THIS LINE * * */
                  (function() {
                      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                  })();
              </script>
              <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
              <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                            
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- JS and analytics only. -->

    <!--<script src="/javascripts/bootstrap.min.js"></script>-->
    <script src="/javascript/search.min.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" src="/javascript/jquery-ui-1.9.1.custom.min.js"></script>
    <!--<script type="text/javascript" src="/javascript/baseline.js"></script>
    <script type="text/javascript" src="/javascript/3scale.js"></script>-->
    <script type="text/javascript" src="/javascript/excanvas.compiled.js"></script>
    
    <!--[if lt IE 9]>
      <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.6/html5shiv.min.js"></script>
      <script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  
  <script>
      //$("#navigation").tocify({ selectors: "h1.menu,h2.menu", theme: "bootstrap", extendPage: false });
    $(".logo a").css("margin-left", $("#navigation").css("margin-left"));

    // collapsible menu
    $(function() {
      $('a').click(function(e) {
        
            
        $('html, body').animate( { scrollTop: $($.attr(this, 'href')).offset().top+'px' }, 500);
      });
      $('.multi').click(function(e) {
        if ($(this).children('#navigation').length == 0 ) {
          $(this).next('.tocsubheader').slideToggle();
          $(this).find('.fa').toggleClass("fa-chevron-left fa-chevron-down");
        }
        else {
          //$(this).find('#navigation ul ul').slideToggle();
        }
      });

      //Current position highlight
      var aChildren = $(".tocify1 .tocheader #this li").children();
      var aArray = [];
      for (var i=0; i< aChildren.length; i++) {
        var aChild = aChildren[i];
        var ahref = $(aChild).attr('href');
        aArray.push(ahref);
      }

      $(window).scroll(function() {
        var windowPos = $(window).scrollTop();
        var windowHeight = $(window).height();
        var docHeight = $(document).height();

        for (var i=0; i< aArray.length; i++) {
          var theID = aArray[i];
          var divPos = $(theID).offset().top-1;
          var divHeight = $(theID).parent().parent().height();
          if (windowPos >= divPos && windowPos < (divPos + divHeight)) {
            $("a[href='" + theID + "']").parent().addClass('active');
          } else {
            $("a[href='" + theID + "']").parent().removeClass('active');
          }
        }

        if(windowPos + windowHeight == docHeight) {
          if (!$(".tocify1 .tocheader #this li:last-child a").parent().hasClass('active')) {
            var navActiveCurrent = $('.active').child().attr('href');
            $("a[href='" + navActiveCurrent + "']").removeClass('active');
            $(".tocify1 .tocheader #this li:last-child").addClass('active');
          }
        }
      });

    });
    /*$('.document-content img').baseline(30);
    $('#search a').click(function(e) {
      $("#search").submit();
    });*/
  $(function() {
    $('#search-query').lunrSearch({
      indexUrl: '/search.json',             // URL of the `search.json` index data for your site
      results:  '#search-results',          // jQuery selector for the search results container
      entries:  '.entries',                 // jQuery selector for the element to contain the results list, must be a child of the results element above.
      template: '#search-results-template'  // jQuery selector for the Mustache.js template
    });
    $("#search-query").keydown(function(event) {
      if(event.keyCode == 13) {
        event.preventDefault();
        return false;
      }
      $(this).val() ? $("#search-results").hide() : $("#search-results").show();
    });
    $("#search-query").keyup(function() {
      if ($(this).val() ) {
        $("#page-content").css("display", "none");
      } else {
        $("#page-content").css("display", "block");
      }
    });
  });
  </script> 
  <script type="text/javascript">
      $(function() {
        $('.multi > a').each(function() {
          if(window.location.pathname == $(this).attr('href'))
            $(this).parent().addClass('active');
        });
      });
    </script>
  </body>
</html>
